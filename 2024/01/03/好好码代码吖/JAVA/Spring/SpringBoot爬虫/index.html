<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="will"><meta name="keywords" content="will"><meta name="description" content="SpringBoot爬虫前言 此文章只是为了学习http请求、jsoup、SpringBoot集成等技术，不是故意爬取数据，文章仅仅记录学习过程！  什么是爬虫爬虫简介 网络爬虫（又被称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本。 　　简单来说就是通过编写脚本模拟浏览器发起请求获取数据。  爬虫分类 通用网络爬虫（"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot爬虫"><meta property="og:url" content="https://github.com/yangxiangnanwill/yangxiangnanwill.github.io/2024/01/03/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/JAVA/Spring/SpringBoot%E7%88%AC%E8%99%AB/index.html"><meta property="og:site_name" content="Will"><meta property="og:description" content="SpringBoot爬虫前言 此文章只是为了学习http请求、jsoup、SpringBoot集成等技术，不是故意爬取数据，文章仅仅记录学习过程！  什么是爬虫爬虫简介 网络爬虫（又被称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本。 　　简单来说就是通过编写脚本模拟浏览器发起请求获取数据。  爬虫分类 通用网络爬虫（"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2021/05/09/gU3m18fBsMroERz.png"><meta property="og:image" content="https://ftp.bmp.ovh/imgs/2021/05/9a5699ef90a52691.jpg"><meta property="og:image" content="https://ftp.bmp.ovh/imgs/2021/05/193a8c2fc8057747.png"><meta property="article:published_time" content="2024-01-03T13:13:21.649Z"><meta property="article:modified_time" content="2024-01-03T13:13:21.649Z"><meta property="article:author" content="will"><meta property="article:tag" content="JAVA"><meta property="article:tag" content="Spring"><meta property="article:tag" content="Spring Boot"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://i.loli.net/2021/05/09/gU3m18fBsMroERz.png"><title>SpringBoot爬虫 - Will</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"github.com",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>WILL</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="SpringBoot爬虫"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-01-03 21:13" pubdate>2024年1月3日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 28k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 238 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">SpringBoot爬虫</h1><div class="markdown-body"><h1 id="SpringBoot爬虫"><a href="#SpringBoot爬虫" class="headerlink" title="SpringBoot爬虫"></a>SpringBoot爬虫</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>此文章只是为了学习http请求、jsoup、SpringBoot集成等技术，不是故意爬取数据，文章仅仅记录学习过程！</p></blockquote><h1 id="什么是爬虫"><a href="#什么是爬虫" class="headerlink" title="什么是爬虫"></a>什么是爬虫</h1><h2 id="爬虫简介"><a href="#爬虫简介" class="headerlink" title="爬虫简介"></a>爬虫简介</h2><blockquote><p>网络爬虫（又被称为网页<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%9C%98%E8%9B%9B/8135707">蜘蛛</a>，网络机器人，在<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/FOAF">FOAF</a>社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%B8%87%E7%BB%B4%E7%BD%91/215515">万维网</a>信息的程序或者脚本。</p><p>　　简单来说就是通过编写脚本模拟浏览器发起请求获取数据。</p></blockquote><h2 id="爬虫分类"><a href="#爬虫分类" class="headerlink" title="爬虫分类"></a>爬虫分类</h2><ul><li>通用网络爬虫（General Purpose Web Crawler）：爬取一整张页面源码数据. 抓取系统(爬虫)</li><li>聚焦网络爬虫（Focused Web Crawler）：爬取的是一张页面中局部的数据(数据解析)</li><li>增量式网络爬虫（Incremental Web Crawler）：用于监测网站数据更新的情况,从而爬取网站中最新更新出来的数据</li><li>深层网络爬虫（Deep Web Crawler）:Web 页面按存在方式可以分为表层网页（Surface Web）和深层网页（Deep Web，也称 Invisible Web Pages 或 Hidden Web）。 表层网页是指传统搜索引擎可以索引的页面，以超链接可以到达的静态网页为主构成的 Web 页面。Deep Web 是那些大部分内容不能通过静态链接获取的、隐藏在搜索表单后的，只有用户提交一些关键词才能获得的 Web 页面。</li></ul><h2 id="反爬机制与反反爬策略"><a href="#反爬机制与反反爬策略" class="headerlink" title="反爬机制与反反爬策略"></a>反爬机制与反反爬策略</h2><p>爬虫：使用任何技术手段，批量获取网站信息的一种方式。</p><p>反爬虫：使用任何技术手段，阻止别人批量获取自己网站信息的一种方式。</p><p>反爬方式：</p><ul><li><code>robots.txt协议</code></li><li><code>UA（User-Agent用户访问网站时候的浏览器标识）限制</code></li><li>UA反爬随机请求头</li><li>ip限制（限制ip访问频率和次数进行反爬）————-构造自己的 IP 代理池，然后每次访问时随机选择代理</li><li>Ajax动态加载——-使用审查元素分析”请求“对应的链接:在url请求的response中进行局部搜索当前内容，如果没有就点击左边任意请求，进行ctrl+f全局搜索，找到对应的请求(抓包工具推荐:fiddler)</li><li>验证码反爬虫或者模拟登陆</li><li>cookie限制</li></ul><h1 id="爬虫案例学习"><a href="#爬虫案例学习" class="headerlink" title="爬虫案例学习"></a>爬虫案例学习</h1><h2 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h2><blockquote><p>前面介绍了几种爬虫的分类，这里我们使用聚焦网络爬虫，抓取汽车之家上的汽车评测数据。<a target="_blank" rel="noopener" href="https://www.autohome.com.cn/bestauto/">https://www.autohome.com.cn/bestauto/</a></p><p>我们需要抓取汽车之家上面所有的汽车评测数据</p><p><img src="https://i.loli.net/2021/05/09/gU3m18fBsMroERz.png" srcset="/img/loading.gif" lazyload alt="image.png"></p></blockquote><p>在页面上我们分析，需要抓取以下部分的数据:</p><ul><li>车型信息</li><li>评测信息</li></ul><blockquote><p>排名是动态生成的，我们这里不做抓取，可以后期单独处理排名</p></blockquote><ul><li>编辑点评</li><li>评测图片</li></ul><blockquote><p>有5张图片，页面显示的是小图，我们需要打开超链接获取大图的url地址，再单独下载图片</p></blockquote><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="使用技术"><a href="#使用技术" class="headerlink" title="使用技术"></a>使用技术</h3><ul><li>JDK1.8+</li><li>SpringBoot2.X</li><li>MyBatisPlus</li><li>SpringMVC</li><li>HttpClient</li><li>Jsoup</li><li>Quartz</li></ul><h3 id="搭建工程"><a href="#搭建工程" class="headerlink" title="搭建工程"></a>搭建工程</h3><h4 id="设置依赖"><a href="#设置依赖" class="headerlink" title="设置依赖"></a>设置依赖</h4><ul><li>新建MAVEN项目</li><li>设置父工程</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>设置项目依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mybatisplus.version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">mybatisplus.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">alibaba.boot.druid</span>&gt;</span>1.1.22<span class="hljs-tag">&lt;/<span class="hljs-name">alibaba.boot.druid</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;mybatisplus.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;alibaba.boot.druid&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 工具类 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- quartz依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- HttpClient --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- jsoup --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.10.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--lombok插件 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="设置配置"><a href="#设置配置" class="headerlink" title="设置配置"></a>设置配置</h4><blockquote><p>配置路径：src&#x2F;main&#x2F;resources</p></blockquote><ul><li>创建<code>application.yml</code></li></ul><blockquote><p>配置总体环境，方便切换环境</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">spider-autohome</span><br></code></pre></td></tr></table></figure><ul><li>创建测试环境配置<code>application-dev.yml</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">tomcat:</span><br>    <span class="hljs-attr">max-swallow-size:</span> <span class="hljs-string">100MB</span><br><br><span class="hljs-comment">#配置数据源</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>      <span class="hljs-attr">driverClassName:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.56.120:3306/spider-autohome?serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8&amp;useSSL=false</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-comment"># 初始化连接大小</span><br>      <span class="hljs-attr">initial-size:</span> <span class="hljs-number">5</span><br>      <span class="hljs-comment"># 最小空闲连接数</span><br>      <span class="hljs-attr">min-idle:</span> <span class="hljs-number">5</span><br>      <span class="hljs-attr">max-active:</span> <span class="hljs-number">30</span><br>      <span class="hljs-attr">max-wait:</span> <span class="hljs-number">60000</span><br>      <span class="hljs-comment"># 可关闭的空闲连接间隔时间</span><br>      <span class="hljs-attr">time-between-eviction-runs-millis:</span> <span class="hljs-number">60000</span><br>      <span class="hljs-comment"># 配置连接在池中的最小生存时间</span><br>      <span class="hljs-attr">min-evictable-idle-time-millis:</span> <span class="hljs-number">300000</span><br>      <span class="hljs-attr">validation-query:</span> <span class="hljs-string">select</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-string">from</span> <span class="hljs-string">dual</span><br>      <span class="hljs-attr">test-while-idle:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">test-on-borrow:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">test-on-return:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-comment"># 打开PSCache，并且指定每个连接上PSCache的大小</span><br>      <span class="hljs-attr">pool-prepared-statements:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">max-open-prepared-statements:</span> <span class="hljs-number">50</span><br>      <span class="hljs-attr">max-pool-prepared-statement-per-connection-size:</span> <span class="hljs-number">20</span><br>      <span class="hljs-comment"># 配置监控统计拦截的filters</span><br>      <span class="hljs-attr">filters:</span> <span class="hljs-string">stat</span><br>      <span class="hljs-attr">stat-view-servlet:</span><br>        <span class="hljs-attr">url-pattern:</span> <span class="hljs-string">/druid/*</span><br>        <span class="hljs-attr">reset-enable:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">login-username:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">login-password:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-attr">web-stat-filter:</span><br>        <span class="hljs-attr">url-pattern:</span> <span class="hljs-string">/*</span><br>        <span class="hljs-attr">exclusions:</span> <span class="hljs-string">&quot;*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*&quot;</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">50MB</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">50MB</span><br><br><span class="hljs-comment"># 配置mybatis-plus日志打印</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br></code></pre></td></tr></table></figure><h2 id="SpringBoot入门"><a href="#SpringBoot入门" class="headerlink" title="SpringBoot入门"></a>SpringBoot入门</h2><blockquote><p>这里先实现入门程序，用以熟悉SpringBoot的使用。</p><p>需求：浏览器访问，获取数据库时间</p></blockquote><h3 id="创建启动引导类"><a href="#创建启动引导类" class="headerlink" title="创建启动引导类"></a>创建启动引导类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiderAutoHomeApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(SpiderAutoHomeApplication.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编写测试DAO"><a href="#编写测试DAO" class="headerlink" title="编写测试DAO"></a>编写测试DAO</h3><ul><li>创建dao文件夹，创建<code>TestDao</code>接口文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TestDao</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询当前时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Select(&quot;SELECT NOW()&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">queryNowDate</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编写测试SERVICE"><a href="#编写测试SERVICE" class="headerlink" title="编写测试SERVICE"></a>编写测试SERVICE</h3><ul><li>创建service文件夹，创建<code>TestService</code>文件</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">TestService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询当前时间</span><br><span class="hljs-comment">     * @return</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">queryNowDate</span>()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编写测试SERVICE实现"><a href="#编写测试SERVICE实现" class="headerlink" title="编写测试SERVICE实现"></a>编写测试SERVICE实现</h3><ul><li>在service文件夹下创建impl文件夹，创建<code>TestServiceImpl</code>文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TestService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TestDao testDao;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">queryNowDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> testDao.queryNowDate();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编写请求CONTROLLER"><a href="#编写请求CONTROLLER" class="headerlink" title="编写请求CONTROLLER"></a>编写请求CONTROLLER</h3><ul><li>创建controller文件夹，创建<code>TestController</code>文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TestService testService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询当前时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(value = &quot;/queryNowDate&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">queryNowDate</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> testService.queryNowDate();<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="启动测试"><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h3><ul><li>启动application启动类</li><li>在浏览器输入请求测试地址：<code>http://localhost:8080/test/queryNowDate</code></li><li>查看返回结果:<code>2021-05-09 09:31:42</code></li></ul><h2 id="开发分析"><a href="#开发分析" class="headerlink" title="开发分析"></a>开发分析</h2><h3 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h3><blockquote><p>分析发现，评测页的url是:</p><p><code>https://www.autohome.com.cn/bestauto/1</code></p><p>最后一个参数是页码数，我们只需要按顺序从第一页开始，把所有的页面都抓取下来就可以了</p></blockquote><h4 id="抓取页面的流程如下"><a href="#抓取页面的流程如下" class="headerlink" title="抓取页面的流程如下"></a>抓取页面的流程如下</h4><p><img src="https://ftp.bmp.ovh/imgs/2021/05/9a5699ef90a52691.jpg" srcset="/img/loading.gif" lazyload></p><h4 id="抓取评测数据步骤"><a href="#抓取评测数据步骤" class="headerlink" title="抓取评测数据步骤"></a>抓取评测数据步骤</h4><ul><li>根据url抓取html页面</li><li>对html页面进行解析，获取该页面所有的评测数据</li><li>遍历所有的评测数据</li><li>判断遍历的评测数据是否已保存，</li><li>如果已保存再次遍历下一条评测数据</li><li>如果未保存执行下一步</li><li>保存评测数据到数据库中</li></ul><h3 id="数据库表设计"><a href="#数据库表设计" class="headerlink" title="数据库表设计"></a>数据库表设计</h3><blockquote><p>根据以上需求，设计数据库表。sql如下：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `car_test` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;主键id&#x27;</span>,<br>  `title` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测车辆的名字&#x27;</span>,<br>  `test_speed` <span class="hljs-type">int</span>(<span class="hljs-number">150</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测项目-加速(0-100公里/小时),单位毫秒&#x27;</span>,<br>  `test_brake` <span class="hljs-type">int</span>(<span class="hljs-number">150</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测项目-刹车(100-0公里/小时),单位毫米&#x27;</span>,<br>  `test_oil` <span class="hljs-type">int</span>(<span class="hljs-number">150</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测项目-实测油耗(升/100公里)，单位毫升&#x27;</span>,<br>  `editor_name1` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测编辑1&#x27;</span>,<br>  `editor_remark1` <span class="hljs-type">varchar</span>(<span class="hljs-number">1000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;点评内容1&#x27;</span>,<br>  `editor_name2` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测编辑2&#x27;</span>,<br>  `editor_remark2` <span class="hljs-type">varchar</span>(<span class="hljs-number">1000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;点评内容2&#x27;</span>,<br>  `editor_name3` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测编辑3&#x27;</span>,<br>  `editor_remark3` <span class="hljs-type">varchar</span>(<span class="hljs-number">1000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;点评内容3&#x27;</span>,<br>  `image` <span class="hljs-type">varchar</span>(<span class="hljs-number">1000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;评测图片，5张图片名，中间用,分隔&#x27;</span>,<br>  `created` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>  `updated` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">7</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;汽车之家评测表&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h3><h4 id="编写实体ENTITY"><a href="#编写实体ENTITY" class="headerlink" title="编写实体ENTITY"></a>编写实体ENTITY</h4><ul><li>创建module【这个依据个人喜好】文件夹，创建<code>CarTest</code>实体对象和数据库表进行映射</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(value = &quot;car_test&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarTest</span> &#123;<br>    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> testSpeed;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> testBrake;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> testOil;<br>    <span class="hljs-keyword">private</span> String editorName1;<br>    <span class="hljs-keyword">private</span> String editorRemark1;<br>    <span class="hljs-keyword">private</span> String editorName2;<br>    <span class="hljs-keyword">private</span> String editorRemark2;<br>    <span class="hljs-keyword">private</span> String editorName3;<br>    <span class="hljs-keyword">private</span> String editorRemark3;<br>    <span class="hljs-keyword">private</span> String image;<br>    <span class="hljs-keyword">private</span> Date created;<br>    <span class="hljs-keyword">private</span> Date updated;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="编写DAO"><a href="#编写DAO" class="headerlink" title="编写DAO"></a>编写DAO</h4><ul><li>在dao文件夹下面创建<code>CarTestDao</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CarTestDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;CarTest&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="编写SERVICE"><a href="#编写SERVICE" class="headerlink" title="编写SERVICE"></a>编写SERVICE</h4><ul><li>在service文件夹下面创建<code>CarTestService</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CarTestService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;CarTest&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 分页查询标题</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page          当前页</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageSize      分页大小</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Page&lt;CarTest&gt; <span class="hljs-title function_">queryTitleByPage</span><span class="hljs-params">(<span class="hljs-type">long</span> page, <span class="hljs-type">long</span> pageSize)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="编写SERVICE实现"><a href="#编写SERVICE实现" class="headerlink" title="编写SERVICE实现"></a>编写SERVICE实现</h4><ul><li>service文件夹下impl文件夹新建<code>CarTestServiceImpl</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarTestServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;CarTestDao,CarTest&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CarTestService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Page&lt;CarTest&gt; <span class="hljs-title function_">queryTitleByPage</span><span class="hljs-params">(<span class="hljs-type">long</span> page, <span class="hljs-type">long</span> pageSize)</span> &#123;<br>        Page&lt;CarTest&gt; queryPage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, pageSize);<br>        QueryWrapper&lt;CarTest&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        queryWrapper.select(<span class="hljs-string">&quot;title&quot;</span>);<br>        <span class="hljs-keyword">return</span>  baseMapper.selectPage(queryPage, queryWrapper);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="爬取数据"><a href="#爬取数据" class="headerlink" title="爬取数据"></a>爬取数据</h2><h3 id="HTTP连接池管理器"><a href="#HTTP连接池管理器" class="headerlink" title="HTTP连接池管理器"></a>HTTP连接池管理器</h3><blockquote><p>因为我们爬取数据是使用的HTTP请求，我们需要一个管理HTTP连接的一个工具，所以我们定义一个HTTP连接池管理工具，交给Spring进行管理。</p><p>使用以下两个注解</p><p>@Configuration注解声明配置类。</p><p>@Bean注解声明如何创建这实例</p></blockquote><ul><li>新建config文件夹，创建<code>HttpClientManagerCfg</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientManagerCfg</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> PoolingHttpClientConnectionManager <span class="hljs-title function_">poolingHttpClientConnectionManager</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 创建连接管理器</span><br>        <span class="hljs-type">PoolingHttpClientConnectionManager</span> <span class="hljs-variable">httpClientConnectionManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PoolingHttpClientConnectionManager</span>();<br>        <span class="hljs-comment">// 设置最大连接数</span><br>        httpClientConnectionManager.setMaxTotal(<span class="hljs-number">50</span>);<br>        <span class="hljs-comment">// 设置每个并发连接数</span><br>        httpClientConnectionManager.setDefaultMaxPerRoute(<span class="hljs-number">20</span>);<br>        <span class="hljs-keyword">return</span> httpClientConnectionManager;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="定时关闭失效连接"><a href="#定时关闭失效连接" class="headerlink" title="定时关闭失效连接"></a>定时关闭失效连接</h3><blockquote><p>这里使用Quartz定时任务来处理定时关闭失效连接</p></blockquote><ul><li>新建job文件夹，创建<code>CloseHttpConnectionJob</code>文件,编写定时任务</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@DisallowConcurrentExecution</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CloseHttpConnectionJob</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">QuartzJobBean</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeInternal</span><span class="hljs-params">(JobExecutionContext context)</span> <span class="hljs-keyword">throws</span> JobExecutionException &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) context.getJobDetail().getJobDataMap().get(<span class="hljs-string">&quot;context&quot;</span>);<br>        <span class="hljs-type">PoolingHttpClientConnectionManager</span> <span class="hljs-variable">httpClientPool</span> <span class="hljs-operator">=</span> applicationContext.getBean(PoolingHttpClientConnectionManager.class);<br>        httpClientPool.closeExpiredConnections();<br>        log.info(<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; closeExpiredConnections&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="定时任务配置"><a href="#定时任务配置" class="headerlink" title="定时任务配置"></a>定时任务配置</h3><ul><li>在config目录下雪创建<code>QuartzConfig</code>文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuartzConfig</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 定义关闭无效连接任务</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean(&quot;closeHttpConnectionJob&quot;)</span><br>    <span class="hljs-keyword">public</span> JobDetailFactoryBean <span class="hljs-title function_">closeHttpConnectionJob</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">JobDetailFactoryBean</span> <span class="hljs-variable">jobDetailFactoryBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobDetailFactoryBean</span>();<br>        jobDetailFactoryBean.setApplicationContextJobDataKey(<span class="hljs-string">&quot;context&quot;</span>);<br>        jobDetailFactoryBean.setJobClass(CloseHttpConnectionJob.class);<br>        jobDetailFactoryBean.setDurability(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-keyword">return</span> jobDetailFactoryBean;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 定义关闭无效连接触发器</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean(&quot;closeHttpConnectionJobTrigger&quot;)</span><br>    <span class="hljs-keyword">public</span> CronTriggerFactoryBean <span class="hljs-title function_">closeHttpConnectionJobTrigger</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@Qualifier(value = &quot;closeHttpConnectionJob&quot;)</span> JobDetailFactoryBean itemJobBean)</span> &#123;<br>        <span class="hljs-type">CronTriggerFactoryBean</span> <span class="hljs-variable">tigger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CronTriggerFactoryBean</span>();<br>        tigger.setJobDetail(itemJobBean.getObject());<br>        tigger.setCronExpression(<span class="hljs-string">&quot;0/5 * * * * ? &quot;</span>);<br>        <span class="hljs-keyword">return</span> tigger;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 定义调度器</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> SchedulerFactoryBean <span class="hljs-title function_">schedulerFactory</span><span class="hljs-params">(CronTrigger[] cronTriggerImpl)</span> &#123;<br>        <span class="hljs-type">SchedulerFactoryBean</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchedulerFactoryBean</span>();<br>        bean.setTriggers(cronTriggerImpl);<br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编写APISERVICE业务接口"><a href="#编写APISERVICE业务接口" class="headerlink" title="编写APISERVICE业务接口"></a>编写APISERVICE业务接口</h3><blockquote><p>需要实现两个功能的下载：</p><p>请求获取页面数据[GET]</p><p>请求下载图片[GET]</p></blockquote><ul><li>新建api.service目录，创建<code>AutoHomeApiService</code>文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AutoHomeApiService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 使用get请求获取页面数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> url</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getHtml</span><span class="hljs-params">(String url)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 使用get请求下载图片,返回图片名称</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> url</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getImage</span><span class="hljs-params">(String url)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="编写APISERVICE实现业务接口"><a href="#编写APISERVICE实现业务接口" class="headerlink" title="编写APISERVICE实现业务接口"></a>编写APISERVICE实现业务接口</h3><ul><li>在api.service下面创建impl文件夹，创建<code>AutoHomeApiServiceImpl</code>文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoHomeApiServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AutoHomeApiService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> PoolingHttpClientConnectionManager connectionManager;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getHtml</span><span class="hljs-params">(String url)</span> &#123;<br>        <span class="hljs-comment">// 使用连接池管理器获取连接</span><br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.custom().setConnectionManager(connectionManager).build();<br>        <span class="hljs-comment">// 创建httpGet请求</span><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(url);<br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">httpResponse</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 发起请求</span><br>             httpResponse = httpClient.execute(httpGet);<br>            <span class="hljs-comment">// 判断请求是否成功</span><br>            <span class="hljs-keyword">if</span> (httpResponse != <span class="hljs-literal">null</span> &amp;&amp; httpResponse.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-comment">// 判断是否有响应体</span><br>                <span class="hljs-keyword">if</span> (httpResponse.getEntity() != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">// 如果有响应体，则进行解析</span><br>                    html = EntityUtils.toString(httpResponse.getEntity(), Charsets.UTF_8);<br>                    <span class="hljs-keyword">return</span> html;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>            log.error(<span class="hljs-string">&quot;获取汽车之家信息异常：&#123;&#125;&quot;</span>, e);<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (httpResponse != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    httpResponse.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                    log.error(<span class="hljs-string">&quot;获取汽车之家信息响应关闭异常：&#123;&#125;&quot;</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getImage</span><span class="hljs-params">(String url)</span> &#123;<br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.custom().setConnectionManager(connectionManager).build();<br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(url);<br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">httpResponse</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            httpResponse = httpClient.execute(httpGet);<br>            <span class="hljs-comment">// 判断请求是否成功</span><br>            <span class="hljs-keyword">if</span> (httpResponse != <span class="hljs-literal">null</span> &amp;&amp; httpResponse.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-comment">// 判断是否有响应体</span><br>                <span class="hljs-keyword">if</span> (httpResponse.getEntity() != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">// 如果有响应体，则进行解析</span><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">contentTypeVal</span> <span class="hljs-operator">=</span> httpResponse.getFirstHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>).getValue();<br>                    <span class="hljs-keyword">if</span>(contentTypeVal.contains(<span class="hljs-string">&quot;image/&quot;</span>))&#123;<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">extName</span> <span class="hljs-operator">=</span>  contentTypeVal.split(<span class="hljs-string">&quot;/&quot;</span>)[<span class="hljs-number">1</span>];<br>                        fileName = UUID.randomUUID().toString().replace(<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-string">&quot;&quot;</span>) + <span class="hljs-string">&quot;.&quot;</span> + extName;<br>                        <span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:/test/autohome-image/&quot;</span> + fileName));<br>                        httpResponse.getEntity().writeTo(os);<br>                        <span class="hljs-keyword">return</span> fileName;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>            log.error(<span class="hljs-string">&quot;获取汽车之家评测图片异常：&#123;&#125;&quot;</span>, e);<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (httpResponse != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    httpResponse.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                    log.error(<span class="hljs-string">&quot;获取汽车之家评测图片响应关闭异常：&#123;&#125;&quot;</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="测试APISERVICE业务实现接口"><a href="#测试APISERVICE业务实现接口" class="headerlink" title="测试APISERVICE业务实现接口"></a>测试APISERVICE业务实现接口</h3><blockquote><p>这里使用SpringBoot的测试组件，需要添加如下两个注解：</p><ul><li>@RunWith(value &#x3D; SpringJUnit4ClassRunner.class)</li></ul><p>让测试运行在spring的环境，这样我们测试的时候就可以和开发的时候一样编写代码,例如使用@Autowired注解直接注入</p><ul><li>@SpringBootTest(classes &#x3D; Application.class)</li></ul><p>执行当前的这个类是测试类,测试代码如下</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@SpringBootTest(classes = SpiderAutoHomeApplication.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoHomeApiServiceTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AutoHomeApiService autoHomeApiService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TitleFilter titleFilter;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CarTestService carTestService;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 测试获取HTML内容</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getHtml</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> autoHomeApiService.getHtml(<span class="hljs-string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;html = &quot;</span> + html);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 测试获取图片</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getImage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">image</span> <span class="hljs-operator">=</span> autoHomeApiService.getImage(<span class="hljs-string">&quot;https://car2.autoimg.cn/cardfs/product/g24/M09/AE/EB/800x0_1_q87_autohomecar__wKgHIVpxGh6AFSN1AAY8kcz3Aww921.jpg&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;image = &quot;</span> + image);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="去重过滤器"><a href="#去重过滤器" class="headerlink" title="去重过滤器"></a>去重过滤器</h2><p>在使用网络爬虫过程中，去重是一个不可避免的问题，这里需要对抓取的数据内容进行过滤，就是对车辆幸好名称进行去重过滤，避免同样条数据反复保存到数据库中。</p><p>传统的去重，可以使用Map或者Set集合、哈希表的方式来实现去重，在数据量较小的情况下，使用这种方式没有问题。可是当我们需要大量爬去数据的时候，这种方式就存在很大问题。因为会极大的占用内存和系统资源，导致爬虫系统崩溃。这里将会使用布隆过滤器。</p><h3 id="Bloom过滤器介绍"><a href="#Bloom过滤器介绍" class="headerlink" title="Bloom过滤器介绍"></a>Bloom过滤器介绍</h3><p>　布隆过滤器主要用于判断一个元素是否在一个集合中，它可以使用一个位数组简洁的表示一个数组。它的空间效率和查询时间远远超过一般的算法，但是它存在一定的误判的概率，适用于容忍误判的场景。如果布隆过滤器判断元素存在于一个集合中，那么大概率是存在在集合中，如果它判断元素不存在一个集合中，那么一定不存在于集合中。常常被用于大数据去重。</p><p><strong>算法思想</strong></p><p>　　布隆过滤器算法主要思想就是利用k个哈希函数计算得到不同的哈希值，然后映射到相应的位数组的索引上，将相应的索引位上的值设置为1。判断该元素是否出现在集合中，就是利用k个不同的哈希函数计算哈希值，看哈希值对应相应索引位置上面的值是否是1，如果有1个不是1，说明该元素不存在在集合中。但是也有可能判断元素在集合中，但是元素不在，这个元素所有索引位置上面的1都是别的元素设置的，这就导致一定的误判几率。布隆过滤的思想如下图所示：</p><p><img src="https://ftp.bmp.ovh/imgs/2021/05/193a8c2fc8057747.png" srcset="/img/loading.gif" lazyload></p><h3 id="布隆过滤器实现"><a href="#布隆过滤器实现" class="headerlink" title="布隆过滤器实现"></a>布隆过滤器实现</h3><ul><li>创建util目录，创建<code>TitleFilter</code>文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TitleFilter</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> &lt;&lt; <span class="hljs-number">24</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] seeds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>, <span class="hljs-number">31</span>, <span class="hljs-number">37</span>, <span class="hljs-number">61</span>&#125;;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">BitSet</span> <span class="hljs-variable">bits</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BitSet</span>(DEFAULT_SIZE);<br>    <span class="hljs-keyword">private</span> SimpleHash[] func = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleHash</span>[seeds.length];<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TitleFilter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; seeds.length; i++) &#123;<br>            func[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleHash</span>(DEFAULT_SIZE, seeds[i]);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String value)</span> &#123;<br>        <span class="hljs-keyword">for</span> (SimpleHash f : func) &#123;<br>            bits.set(f.hash(value), <span class="hljs-literal">true</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(String value)</span> &#123;<br>        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">for</span> (SimpleHash f : func) &#123;<br>            ret = ret &amp;&amp; bits.get(f.hash(value));<br>        &#125;<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 内部类，simpleHash</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleHash</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cap;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> seed;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleHash</span><span class="hljs-params">(<span class="hljs-type">int</span> cap, <span class="hljs-type">int</span> seed)</span> &#123;<br>            <span class="hljs-built_in">this</span>.cap = cap;<br>            <span class="hljs-built_in">this</span>.seed = seed;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(String value)</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> value.length();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>                result = seed * result + value.charAt(i);<br>            &#125;<br>            <span class="hljs-keyword">return</span> (cap - <span class="hljs-number">1</span>) &amp; result;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="初始化去重过滤器"><a href="#初始化去重过滤器" class="headerlink" title="初始化去重过滤器"></a>初始化去重过滤器</h3><blockquote><p>项目一启动，就应该创建去重过滤器。</p><p>编写以下代码实现过滤器初始化</p></blockquote><h4 id="CarTestService增加分页查询方法"><a href="#CarTestService增加分页查询方法" class="headerlink" title="CarTestService增加分页查询方法"></a>CarTestService增加分页查询方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 分页查询标题</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page          当前页</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageSize      分页大小</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> Page&lt;CarTest&gt; <span class="hljs-title function_">queryTitleByPage</span><span class="hljs-params">(<span class="hljs-type">long</span> page, <span class="hljs-type">long</span> pageSize)</span>;<br></code></pre></td></tr></table></figure><h4 id="CarTestService增加分页查询方法实现"><a href="#CarTestService增加分页查询方法实现" class="headerlink" title="CarTestService增加分页查询方法实现"></a>CarTestService增加分页查询方法实现</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">@Override<br>public Page&lt;CarTest&gt; query<span class="hljs-constructor">TitleByPage(<span class="hljs-params">long</span> <span class="hljs-params">page</span>, <span class="hljs-params">long</span> <span class="hljs-params">pageSize</span>)</span> &#123;<br>    Page&lt;CarTest&gt; queryPage = <span class="hljs-keyword">new</span> Page&lt;&gt;(page, pageSize);<br>    QueryWrapper&lt;CarTest&gt; queryWrapper = <span class="hljs-keyword">new</span> QueryWrapper&lt;&gt;<span class="hljs-literal">()</span>;<br>    queryWrapper.select(<span class="hljs-string">&quot;title&quot;</span>);<br>    return  baseMapper.select<span class="hljs-constructor">Page(<span class="hljs-params">queryPage</span>, <span class="hljs-params">queryWrapper</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="实现初始化去重过滤器"><a href="#实现初始化去重过滤器" class="headerlink" title="实现初始化去重过滤器"></a>实现初始化去重过滤器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TitleFilterConfig</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CarTestService carTestService;<br><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> TitleFilter <span class="hljs-title function_">titleFilter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 创建车辆标题过滤器</span><br>        <span class="hljs-type">TitleFilter</span> <span class="hljs-variable">titleFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TitleFilter</span>();<br>        <span class="hljs-comment">// 从数据库查询车辆标题，分页查询</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">5000</span>;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">repatedFlag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            Page&lt;CarTest&gt; carTestPage = carTestService.queryTitleByPage(page, pageSize);<br>            <span class="hljs-keyword">if</span> (!carTestPage.hasNext()) &#123;<br>                repatedFlag = <span class="hljs-literal">false</span>;<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                page += <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">for</span> (CarTest record : carTestPage.getRecords()) &#123;<br>                titleFilter.add(record.getTitle());<br>            &#125;<br>        &#125; <span class="hljs-keyword">while</span> (repatedFlag);<br>        <span class="hljs-keyword">return</span> titleFilter;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实现爬取数据"><a href="#实现爬取数据" class="headerlink" title="实现爬取数据"></a>实现爬取数据</h2><blockquote><p>首先实现数据爬取逻辑，先在测试方法中实现</p></blockquote><h3 id="实现爬取测试方法"><a href="#实现爬取测试方法" class="headerlink" title="实现爬取测试方法"></a>实现爬取测试方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@SpringBootTest(classes = SpiderAutoHomeApplication.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoHomeApiServiceTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AutoHomeApiService autoHomeApiService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TitleFilter titleFilter;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CarTestService carTestService;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 测试获取HTML内容</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getHtml</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> autoHomeApiService.getHtml(<span class="hljs-string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;html = &quot;</span> + html);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 测试获取图片</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getImage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">image</span> <span class="hljs-operator">=</span> autoHomeApiService.getImage(<span class="hljs-string">&quot;https://car2.autoimg.cn/cardfs/product/g24/M09/AE/EB/800x0_1_q87_autohomecar__wKgHIVpxGh6AFSN1AAY8kcz3Aww921.jpg&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;image = &quot;</span> + image);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取评测数据</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetEvaluatingResult</span><span class="hljs-params">()</span> &#123;<br>        List&lt;CarTest&gt; saveList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">baseUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> autoHomeApiService.getHtml(baseUrl + i);<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> Jsoup.parse(html);<br>            <span class="hljs-type">Elements</span> <span class="hljs-variable">carElements</span> <span class="hljs-operator">=</span> document.getElementsByClass(<span class="hljs-string">&quot;uibox&quot;</span>);<br>            <span class="hljs-keyword">for</span> (Element carElement : carElements) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">carTitle</span> <span class="hljs-operator">=</span> carElement.getElementsByClass(<span class="hljs-string">&quot;uibox-title uibox-title-border&quot;</span>).text();<br>               <span class="hljs-comment">/* if (titleFilter.contains(carTitle)) &#123;</span><br><span class="hljs-comment">                    continue;</span><br><span class="hljs-comment">                &#125;*/</span><br>                <span class="hljs-type">CarTest</span> <span class="hljs-variable">carTest</span> <span class="hljs-operator">=</span> marshalCarElement(carElement);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">imageNames</span> <span class="hljs-operator">=</span> marshalImageNames(carElement);<br>                carTest.setImage(imageNames);<br>                saveList.add(carTest);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(saveList)) &#123;<br>                carTestService.saveBatch(saveList);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析数据下载评测图片</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> carElement</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">marshalImageNames</span><span class="hljs-params">(Element carElement)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">carImageName</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        List&lt;String&gt; imageNameList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">Elements</span> <span class="hljs-variable">imageElements</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.piclist-box.fn-clear ul.piclist02 a&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Element imageElement : imageElements) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">imageUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https:&quot;</span> + imageElement.getElementsByTag(<span class="hljs-string">&quot;img&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">imageName</span> <span class="hljs-operator">=</span> autoHomeApiService.getImage(imageUrl);<br>            imageNameList.add(imageName);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(imageNameList)) &#123;<br>            carImageName =  StringUtils.join(imageNameList, <span class="hljs-string">&quot;,&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> carImageName;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析数据封装成汽车评测对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> carElement</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> CarTest <span class="hljs-title function_">marshalCarElement</span><span class="hljs-params">(Element carElement)</span> &#123;<br>        <span class="hljs-type">CarTest</span> <span class="hljs-variable">carTest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CarTest</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">carTitle</span> <span class="hljs-operator">=</span> carElement.getElementsByClass(<span class="hljs-string">&quot;uibox-title uibox-title-border&quot;</span>).text();<br>        carTest.setTitle(carTitle);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">testSpeed</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox1 dd:nth-child(2) &gt; div.dd-div2&quot;</span>).first().text();<br>        carTest.setTestSpeed(covertStrToNum(testSpeed));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">testBrake</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox1 dd:nth-child(3) &gt; div.dd-div2&quot;</span>).first().text();<br>        carTest.setTestBrake(covertStrToNum(testBrake));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">testOil</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox1 dd:nth-child(4) &gt; div.dd-div2&quot;</span>).first().text();<br>        carTest.setTestOil(covertStrToNum(testOil));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorName1</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(2) &gt; div.dd-div1&quot;</span>).first().text();<br>        carTest.setEditorName1(editorName1);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorRemark1</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(2) &gt; div.dd-div3&quot;</span>).first().text();<br>        carTest.setEditorRemark1(editorRemark1);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorName2</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(3) &gt; div.dd-div1&quot;</span>).first().text();<br>        carTest.setEditorName2(editorName2);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorRemark2</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(3) &gt; div.dd-div3&quot;</span>).first().text();<br>        carTest.setEditorRemark2(editorRemark2);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorName3</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(4) &gt; div.dd-div1&quot;</span>).first().text();<br>        carTest.setEditorName3(editorName3);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorRemark3</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(4) &gt; div.dd-div3&quot;</span>).first().text();<br>        carTest.setEditorRemark3(editorRemark3);<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">currentDate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>        carTest.setCreated(currentDate);<br>        carTest.setUpdated(currentDate);<br>        <span class="hljs-keyword">return</span> carTest;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 把字符串去掉最后一个数，转为乘以1000的数字</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> str</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">covertStrToNum</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;--&quot;</span>.equals(str)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-comment">// 字符串去掉随后一个数</span><br>            str = StringUtils.substring(str, <span class="hljs-number">0</span>, str.length() - <span class="hljs-number">1</span>);<br>            <span class="hljs-comment">// 转换为小数并乘以1000</span><br>            <span class="hljs-type">Number</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> Float.valueOf(str) * <span class="hljs-number">1000</span>;<br>            <span class="hljs-keyword">return</span> num.intValue();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            System.out.println(str);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="整合任务"><a href="#整合任务" class="headerlink" title="整合任务"></a>整合任务</h2><blockquote><p>把测试方法中的爬取数据代码改造为任务，再使用Quartz定时任务定时处理，就可以实现定时抓取汽车评测数据，能够获取最新的数据了</p></blockquote><h3 id="改造任务"><a href="#改造任务" class="headerlink" title="改造任务"></a>改造任务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@DisallowConcurrentExecution</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CrawlerAutoHomeJob</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">QuartzJobBean</span> &#123;<br><br>    <span class="hljs-keyword">private</span> AutoHomeApiService autoHomeApiService;<br>    <span class="hljs-keyword">private</span> TitleFilter titleFilter;<br>    <span class="hljs-keyword">private</span> CarTestService carTestService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeInternal</span><span class="hljs-params">(JobExecutionContext context)</span> <span class="hljs-keyword">throws</span> JobExecutionException &#123;<br>        log.info(<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; start crawlerAutoHomeJob&quot;</span>);<br>        <span class="hljs-comment">// 获取spring容器</span><br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) context.getJobDetail().getJobDataMap()<br>                .get(<span class="hljs-string">&quot;context&quot;</span>);<br><br>        <span class="hljs-comment">// 获取抓取数据服务</span><br>        <span class="hljs-built_in">this</span>.autoHomeApiService = applicationContext.getBean(AutoHomeApiService.class);<br>        <span class="hljs-comment">// 获取汽车评测服务</span><br>        <span class="hljs-built_in">this</span>.carTestService = applicationContext.getBean(CarTestService.class);<br>        <span class="hljs-comment">// 获取过滤器</span><br>        <span class="hljs-built_in">this</span>.titleFilter = applicationContext.getBean(TitleFilter.class);<br><br>        List&lt;CarTest&gt; saveList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">188</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">baseUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span> + i;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> autoHomeApiService.getHtml(baseUrl);<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> Jsoup.parse(html);<br>            <span class="hljs-type">Elements</span> <span class="hljs-variable">carElements</span> <span class="hljs-operator">=</span> document.getElementsByClass(<span class="hljs-string">&quot;uibox&quot;</span>);<br>            <span class="hljs-keyword">for</span> (Element carElement : carElements) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">carTitle</span> <span class="hljs-operator">=</span> carElement.getElementsByClass(<span class="hljs-string">&quot;uibox-title uibox-title-border&quot;</span>).text();<br>               <span class="hljs-comment">/* if (titleFilter.contains(carTitle)) &#123;</span><br><span class="hljs-comment">                    continue;</span><br><span class="hljs-comment">                &#125;*/</span><br>                <span class="hljs-type">CarTest</span> <span class="hljs-variable">carTest</span> <span class="hljs-operator">=</span> marshalCarElement(carElement);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">imageNames</span> <span class="hljs-operator">=</span> marshalImageNames(carElement);<br>                carTest.setImage(imageNames);<br>                saveList.add(carTest);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(saveList)) &#123;<br>                carTestService.saveBatch(saveList);<br>            &#125;<br>        &#125;<br>        log.info(<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; end crawlerAutoHomeJob&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析数据下载评测图片</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> carElement</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">marshalImageNames</span><span class="hljs-params">(Element carElement)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">carImageName</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        List&lt;String&gt; imageNameList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">Elements</span> <span class="hljs-variable">imageElements</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.piclist-box.fn-clear ul.piclist02 a&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Element imageElement : imageElements) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">imageUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https:&quot;</span> + imageElement.getElementsByTag(<span class="hljs-string">&quot;img&quot;</span>).attr(<span class="hljs-string">&quot;src&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">imageName</span> <span class="hljs-operator">=</span> autoHomeApiService.getImage(imageUrl);<br>            imageNameList.add(imageName);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(imageNameList)) &#123;<br>            carImageName =  StringUtils.join(imageNameList, <span class="hljs-string">&quot;,&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> carImageName;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析数据封装成汽车评测对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> carElement</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> CarTest <span class="hljs-title function_">marshalCarElement</span><span class="hljs-params">(Element carElement)</span> &#123;<br>        <span class="hljs-type">CarTest</span> <span class="hljs-variable">carTest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CarTest</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">carTitle</span> <span class="hljs-operator">=</span> carElement.getElementsByClass(<span class="hljs-string">&quot;uibox-title uibox-title-border&quot;</span>).text();<br>        carTest.setTitle(carTitle);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">testSpeed</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox1 dd:nth-child(2) &gt; div.dd-div2&quot;</span>).first().text();<br>        carTest.setTestSpeed(covertStrToNum(testSpeed));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">testBrake</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox1 dd:nth-child(3) &gt; div.dd-div2&quot;</span>).first().text();<br>        carTest.setTestBrake(covertStrToNum(testBrake));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">testOil</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox1 dd:nth-child(4) &gt; div.dd-div2&quot;</span>).first().text();<br>        carTest.setTestOil(covertStrToNum(testOil));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorName1</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(2) &gt; div.dd-div1&quot;</span>).first().text();<br>        carTest.setEditorName1(editorName1);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorRemark1</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(2) &gt; div.dd-div3&quot;</span>).first().text();<br>        carTest.setEditorRemark1(editorRemark1);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorName2</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(3) &gt; div.dd-div1&quot;</span>).first().text();<br>        carTest.setEditorName2(editorName2);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorRemark2</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(3) &gt; div.dd-div3&quot;</span>).first().text();<br>        carTest.setEditorRemark2(editorRemark2);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorName3</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(4) &gt; div.dd-div1&quot;</span>).first().text();<br>        carTest.setEditorName3(editorName3);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">editorRemark3</span> <span class="hljs-operator">=</span> carElement.select(<span class="hljs-string">&quot;.tabbox2.tabbox-score dd:nth-child(4) &gt; div.dd-div3&quot;</span>).first().text();<br>        carTest.setEditorRemark3(editorRemark3);<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">currentDate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>        carTest.setCreated(currentDate);<br>        carTest.setUpdated(currentDate);<br>        <span class="hljs-keyword">return</span> carTest;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 把字符串去掉最后一个数，转为乘以1000的数字</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> str</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">covertStrToNum</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;--&quot;</span>.equals(str)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-comment">// 字符串去掉随后一个数</span><br>            str = StringUtils.substring(str, <span class="hljs-number">0</span>, str.length() - <span class="hljs-number">1</span>);<br>            <span class="hljs-comment">// 转换为小数并乘以1000</span><br>            <span class="hljs-type">Number</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> Float.valueOf(str) * <span class="hljs-number">1000</span>;<br>            <span class="hljs-keyword">return</span> num.intValue();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            System.out.println(str);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="增加定时任务"><a href="#增加定时任务" class="headerlink" title="增加定时任务"></a>增加定时任务</h3><ul><li>在定时任务配置<code>QuartzConfig</code>中添加爬取汽车之家的定时任务</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 定义定时爬取评测任务任务</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Bean(&quot;crawlerAutoHomeJob&quot;)</span><br><span class="hljs-keyword">public</span> JobDetailFactoryBean <span class="hljs-title function_">crawlerAutoHomeJob</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">JobDetailFactoryBean</span> <span class="hljs-variable">jobDetailFactoryBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobDetailFactoryBean</span>();<br>    jobDetailFactoryBean.setApplicationContextJobDataKey(<span class="hljs-string">&quot;context&quot;</span>);<br>    jobDetailFactoryBean.setJobClass(CrawlerAutoHomeJob.class);<br>    jobDetailFactoryBean.setDurability(<span class="hljs-literal">true</span>);<br><br>    <span class="hljs-keyword">return</span> jobDetailFactoryBean;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 定义关闭无效连接触发器</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Bean(&quot;crawlerAutoHomeJobTrigger&quot;)</span><br><span class="hljs-keyword">public</span> CronTriggerFactoryBean <span class="hljs-title function_">crawlerAutoHomeJobTrigger</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-meta">@Qualifier(value = &quot;crawlerAutoHomeJob&quot;)</span> JobDetailFactoryBean itemJobBean)</span> &#123;<br>    <span class="hljs-type">CronTriggerFactoryBean</span> <span class="hljs-variable">tigger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CronTriggerFactoryBean</span>();<br>    tigger.setJobDetail(itemJobBean.getObject());<br>    tigger.setCronExpression(<span class="hljs-string">&quot;0/5 * * * * ? &quot;</span>);<br>    <span class="hljs-keyword">return</span> tigger;<br>&#125;<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/" class="category-chain-item">好好码代码吖</a> <span>></span> <a href="/categories/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/JAVA/" class="category-chain-item">JAVA</a> <span>></span> <a href="/categories/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/JAVA/Spring/" class="category-chain-item">Spring</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/JAVA/">#JAVA</a> <a href="/tags/Spring/">#Spring</a> <a href="/tags/Spring-Boot/">#Spring Boot</a></div></div><div class="license-box my-3"><div class="license-title"><div>SpringBoot爬虫</div><div>https://github.com/yangxiangnanwill/yangxiangnanwill.github.io/2024/01/03/好好码代码吖/JAVA/Spring/SpringBoot爬虫/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>will</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2024年1月3日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2024/01/03/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/JAVA/%E5%85%B6%E4%BB%96/ProtoBuffer%E7%AC%94%E8%AE%B0/" title="ProtoBuffer笔记"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">ProtoBuffer笔记</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2024/01/03/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/JAVA/Spring/Spring-Cloud-Alibaba(6)-%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" title="Spring-Cloud-Alibaba(6)-链路追踪"><span class="hidden-mobile">Spring-Cloud-Alibaba(6)-链路追踪</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing;(t=t.getElementById("subtitle"))&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>