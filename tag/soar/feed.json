{
    "version": "https://jsonfeed.org/version/1",
    "title": "Will • All posts by \"soar\" tag",
    "description": "愿你一生努力，一生被爱",
    "home_page_url": "https://github.com/yangxiangnanwill/yangxiangnanwill.github.io",
    "items": [
        {
            "id": "https://github.com/yangxiangnanwill/yangxiangnanwill.github.io/2024/01/03/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/JAVA/%E5%85%B6%E4%BB%96/SOAR%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/",
            "url": "https://github.com/yangxiangnanwill/yangxiangnanwill.github.io/2024/01/03/%E5%A5%BD%E5%A5%BD%E7%A0%81%E4%BB%A3%E7%A0%81%E5%90%96/JAVA/%E5%85%B6%E4%BB%96/SOAR%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/",
            "title": "SOAR基础教程",
            "date_published": "2024-01-03T13:13:21.650Z",
            "content_html": "<blockquote>\n<p>因博猪最近负责报表模块的相关的开发，虽然类似润乾、帆软这种报表工具对于大型SQL的运行做了一定的优化，但是具体优化还是需要书写者的上去了功底的，由于报表的SQL一般很复杂，再加上有一部分的因为历史原因建表的时候没有太多的关联关系，导致相关统计的时候不得不使用子查询，所以导致最后的SQL有可能会运行很久，所以博猪最近不得不的每次都在<code>EXPLIAN</code>的道路上摸索，理解和转化SQL分析的过程很枯燥很机械，这个是博猪经朋友推荐使用的，感觉对于SQL分析挺方便的，特此记录一下，原因无他，唯懒而已。</p>\n</blockquote>\n<h1 id=\"软件介绍\"><a href=\"#软件介绍\" class=\"headerlink\" title=\"软件介绍\"></a>软件介绍</h1><p>SOAR(SQL Optimizer And Rewriter)是一个对SQL进行优化和改写的自动化工具。 由小米人工智能与云平台的数据库团队开发与维护。</p>\n<h2 id=\"功能特点\"><a href=\"#功能特点\" class=\"headerlink\" title=\"功能特点\"></a>功能特点</h2><ul>\n<li>跨平台支持（支持Linux, Mac环境，Windows环境理论上也支持，不过未全面测试）</li>\n<li>目前只支持 MySQL 语法族协议的SQL优化</li>\n<li>支持基于启发式算法的语句优化</li>\n<li>支持复杂查询的多列索引优化（UPDATE, INSERT, DELETE, SELECT）</li>\n<li>支持EXPLAIN信息丰富解读</li>\n<li>支持SQL指纹、压缩和美化</li>\n<li>支持同一张表多条ALTER请求合并</li>\n<li>支持自定义规则的SQL改写</li>\n</ul>\n<h1 id=\"环境搭建\"><a href=\"#环境搭建\" class=\"headerlink\" title=\"环境搭建\"></a>环境搭建</h1><h2 id=\"安装基本环境\"><a href=\"#安装基本环境\" class=\"headerlink\" title=\"安装基本环境\"></a>安装基本环境</h2><p><a href=\"https://studygolang.com/dl\">下载Go</a></p>\n<p>选择windows版本下载，安装。</p>\n<p>安装完成后，cmd中输入 go version ，出现版本信息。</p>\n<p><img src=\"http://tva1.sinaimg.cn/large/0086NgqGgy1h2xcjbah2xj30b902x74h.jpg\" alt=\"image.png\"></p>\n<h2 id=\"soar下载\"><a href=\"#soar下载\" class=\"headerlink\" title=\"soar下载\"></a>soar下载</h2><blockquote>\n<p><a href=\"https://github.com/XiaoMi/soar\">GitHub地址</a></p>\n</blockquote>\n<p><a href=\"https://github.com/XiaoMi/soar/releases\">点击下载选择windows版本下载</a></p>\n<blockquote>\n<p>eg:我放到了<code>D:\\Program Files\\soar</code>目录下面，将soar.windows-amd64重命名为soar.exe</p>\n</blockquote>\n<p>添加环境变量，方便往后使用。</p>\n<p>cmd中 输入 soar -version命令，出行版本信息为安装成功。</p>\n<p><img src=\"http://tva1.sinaimg.cn/large/0086NgqGgy1h2xcrq99pej30g503mjs3.jpg\" alt=\"image.png\"></p>\n<p>soar —help 查看帮助手册</p>\n<p><img src=\"http://tva1.sinaimg.cn/large/0086NgqGgy1h2xcse7fc1j30ma0mbaht.jpg\" alt=\"image.png\"></p>\n<h1 id=\"进阶使用\"><a href=\"#进阶使用\" class=\"headerlink\" title=\"进阶使用\"></a>进阶使用</h1><h2 id=\"相关配置\"><a href=\"#相关配置\" class=\"headerlink\" title=\"相关配置\"></a>相关配置</h2><blockquote>\n<p>在<code>soar</code>软件目录下面创建<code>etc</code>文件夹，并建立<code>soar.yaml</code>文件,并复制一下内容</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-comment\"># 线上环境配置</span><br><span class=\"hljs-attr\">online-dsn:</span><br>  <span class=\"hljs-attr\">addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-string\">:3306</span><br>  <span class=\"hljs-attr\">schema:</span> <span class=\"hljs-string\">soar-test</span><br>  <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">root</span><br>  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">admin</span><br>  <span class=\"hljs-attr\">disable:</span> <span class=\"hljs-literal\">true</span><br><span class=\"hljs-comment\"># 测试环境配置</span><br><span class=\"hljs-attr\">test-dsn:</span><br>  <span class=\"hljs-attr\">addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-string\">:3306</span><br>  <span class=\"hljs-attr\">schema:</span> <span class=\"hljs-string\">soar-test</span><br>  <span class=\"hljs-attr\">user:</span> <span class=\"hljs-string\">root</span><br>  <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">admin</span><br>  <span class=\"hljs-attr\">disable:</span> <span class=\"hljs-literal\">true</span><br><span class=\"hljs-comment\"># 是否允许测试环境与线上环境配置相同</span><br><span class=\"hljs-attr\">allow-online-as-test:</span> <span class=\"hljs-literal\">true</span><br><span class=\"hljs-comment\"># 是否清理测试时产生的临时文件</span><br><span class=\"hljs-attr\">drop-test-temporary:</span> <span class=\"hljs-literal\">true</span><br><span class=\"hljs-comment\"># 语法检查小工具</span><br><span class=\"hljs-attr\">only-syntax-check:</span> <span class=\"hljs-literal\">false</span><br><span class=\"hljs-attr\">sampling-statistic-target:</span> <span class=\"hljs-number\">100</span><br><span class=\"hljs-attr\">sampling:</span> <span class=\"hljs-literal\">false</span><br><span class=\"hljs-comment\"># 日志级别，[0:Emergency, 1:Alert, 2:Critical, 3:Error, 4:Warning, 5:Notice, 6:Informational, 7:Debug]</span><br><span class=\"hljs-attr\">log-level:</span> <span class=\"hljs-number\">7</span><br><span class=\"hljs-attr\">log-output:</span> <span class=\"hljs-string\">etc/soar.log</span><br><span class=\"hljs-comment\"># 优化建议输出格式</span><br><span class=\"hljs-attr\">report-type:</span> <span class=\"hljs-string\">markdown</span><br><span class=\"hljs-attr\">ignore-rules:</span><br><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;&quot;</span><br><span class=\"hljs-comment\"># 黑名单中的 SQL 将不会给评审意见。一行一条 SQL，可以是正则也可以是指纹，填写指纹时注意问号需要加反斜线转义。</span><br><span class=\"hljs-attr\">blacklist:</span> <span class=\"hljs-string\">etc/soar.blacklist</span><br><span class=\"hljs-comment\"># 启发式算法相关配置</span><br><span class=\"hljs-attr\">max-join-table-count:</span> <span class=\"hljs-number\">5</span><br><span class=\"hljs-attr\">max-group-by-cols-count:</span> <span class=\"hljs-number\">5</span><br><span class=\"hljs-attr\">max-distinct-count:</span> <span class=\"hljs-number\">5</span><br><span class=\"hljs-attr\">max-index-cols-count:</span> <span class=\"hljs-number\">5</span><br><span class=\"hljs-attr\">max-total-rows:</span> <span class=\"hljs-number\">9999999</span><br><span class=\"hljs-attr\">spaghetti-query-length:</span> <span class=\"hljs-number\">2048</span><br><span class=\"hljs-attr\">allow-drop-index:</span> <span class=\"hljs-literal\">false</span><br><span class=\"hljs-comment\"># EXPLAIN相关配置</span><br><span class=\"hljs-attr\">explain-sql-report-type:</span> <span class=\"hljs-string\">pretty</span><br><span class=\"hljs-attr\">explain-type:</span> <span class=\"hljs-string\">extended</span><br><span class=\"hljs-attr\">explain-format:</span> <span class=\"hljs-string\">traditional</span><br><span class=\"hljs-attr\">explain-warn-select-type:</span><br><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;&quot;</span><br><span class=\"hljs-attr\">explain-warn-access-type:</span><br><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ALL</span><br><span class=\"hljs-attr\">explain-max-keys:</span> <span class=\"hljs-number\">3</span><br><span class=\"hljs-attr\">explain-min-keys:</span> <span class=\"hljs-number\">0</span><br><span class=\"hljs-attr\">explain-max-rows:</span> <span class=\"hljs-number\">10000</span><br><span class=\"hljs-attr\">explain-warn-extra:</span><br><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&quot;&quot;</span><br><span class=\"hljs-attr\">explain-max-filtered:</span> <span class=\"hljs-number\">100</span><br><span class=\"hljs-attr\">explain-warn-scalability:</span><br><span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">O(n)</span><br><span class=\"hljs-attr\">query:</span> <span class=\"hljs-string\">&quot;&quot;</span><br><span class=\"hljs-attr\">list-heuristic-rules:</span> <span class=\"hljs-literal\">false</span><br><span class=\"hljs-attr\">list-test-sqls:</span> <span class=\"hljs-literal\">false</span><br><span class=\"hljs-attr\">verbose:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">soar -query renewal_six_first_track.sql &gt; ./renewal_six_first_track.md -test-dsn=&quot;root:admin@127.0.0.0:3306/soar-test&quot; -allow-online-as-test<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"查看生成报告\"><a href=\"#查看生成报告\" class=\"headerlink\" title=\"查看生成报告\"></a>查看生成报告</h2><blockquote>\n<p>SQL代码分析报告会生成一个Markdown文件，可通过Markdown文件查看SQL性能分析情况。</p>\n</blockquote>\n<p><img src=\"http://tva1.sinaimg.cn/large/0086NgqGgy1h2xcvilni2j31eo0qu7ea.jpg\" alt=\"image.png\"></p>\n",
            "tags": [
                "SOAR",
                "其他"
            ]
        }
    ]
}